<!-- Novo index.html com as mudan√ßas solicitadas -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Mini Tycoon ‚Äî Farm & Upgrade</title>
<style>
:root {
  --bg: #0f1724;
  --card: #0b1220;
  --accent: #7c3aed;
  --muted: #94a3b8;
  --glass: rgba(255, 255, 255, 0.04);
  --success: #16a34a;
  --danger: #ef4444;
  --text: #e6eef8;
}
body.palette-red { --accent: #ef4444; }
body.palette-yellow { --accent: #f59e0b; }
body.palette-purple { --accent: #7c3aed; }
body.palette-black { --accent: #111827; }
body.palette-default { --accent: #7c3aed; }
body.clear {
  --bg: #f9fafb;
  --card: #ffffff;
  --muted: #6b7280;
  --glass: rgba(0, 0, 0, 0.05);
  --success: #22c55e;
  --danger: #ef4444;
  --text: #111827;
}
body.clear.palette-red { --accent: #ef4444; }
body.clear.palette-yellow { --accent: #f59e0b; }
body.clear.palette-purple { --accent: #7c3aed; }
body.clear.palette-black { --accent: #111827; }
body.clear.palette-default { --accent: #3b82f6; }
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: Inter, ui-sans-serif, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
}
a { color: var(--accent); text-decoration: none; }
header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 20px;
  background: var(--card);
  box-shadow: 0 2px 6px rgba(0,0,0,0.4);
  border-radius: 0 0 10px 10px;
}
header .logo {
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 700;
  font-size: 18px;
  color: var(--accent);
}
header .meta {
  display: flex;
  align-items: center;
  gap: 10px;
}
header .badge {
  padding: 6px 10px;
  border-radius: 999px;
  background: var(--glass);
  font-weight: 700;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}
header .top-right {
  display: flex;
  gap: 10px;
  align-items: center;
}
.card {
  background: var(--card);
  border-radius: 10px;
  padding: 10px 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.4);
}
.small { font-size: 13px; color: var(--muted); }
button.icon {
  background: var(--glass);
  border: 1px solid transparent;
  border-radius: 8px;
  padding: 8px 10px;
  cursor: pointer;
  color: var(--text);
}
button.icon:hover { border-color: var(--accent); }
.main {
  display: flex;
  flex-direction: column;
  gap: 20px;
  padding: 20px;
}
.right-column {
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.panel {
  background: var(--card);
  border-radius: 10px;
  padding: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.35);
}
.big-num { font-size: 28px; font-weight: 700; }
.sub { font-size: 14px; color: var(--muted); margin-bottom: 8px; font-weight: 600; }
.shop, .upgrades, .log { max-height: 240px; overflow-y: auto; }
.item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  border-radius: 8px;
  background: var(--glass);
  margin-bottom: 10px;
  gap: 10px;
}
.item .left { display: flex; align-items: center; gap: 10px; }
.item .icon { font-size: 20px; }
.item button {
  background: var(--accent);
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
}
.item button:hover { opacity: 0.85; }
.upgrade {
  width: 100%;
  text-align: left;
  padding: 12px;
  border-radius: 8px;
  background: var(--glass);
  margin-bottom: 6px;
  border: 1px solid transparent;
  cursor: pointer;
  color: var(--text);
}
.upgrade.bought { opacity: 0.6; border-color: var(--accent); }
.farm-btn {
  width: 100%;
  padding: 10px;
  border: none;
  border-radius: 8px;
  background: var(--accent);
  color: white;
  font-weight: 700;
  cursor: pointer;
}
.row { display: flex; gap: 10px; align-items: center; justify-content: space-between; }
.kv { font-size: 13px; color: var(--muted); }
.kv .v { color: var(--text); font-weight: 700; }
</style>
</head>
<body>
<header>
  <div class="logo">üå± Mini Tycoon ‚Äî Farm & Upgrade</div>
  <div class="meta">
    <span class="badge">üí∞ <span id="moneyTop">0</span></span>
    <span class="badge">üèÖ <span id="levelDisplay">N√≠vel 1</span></span>
  </div>
  <div class="top-right">
    <button onclick="window.location.href='missions.html'" class="icon">üéØ</button>
    <button id="configBtn" class="icon">‚öôÔ∏è</button>
  </div>
</header>
<div class="main">
  <div class="panel">
    <div class="row">
      <div>
        <div class="big-num" id="coins">0</div>
        <div class="kv">CPS: <span class="v" id="cps">0</span></div>
      </div>
      <button class="farm-btn" id="farmBtn">Colher +1</button>
    </div>
  </div>
  <div class="panel">
    <div class="sub">Loja</div>
    <div class="shop" id="shop"></div>
  </div>
  <div class="panel">
    <div class="sub">Upgrades</div>
    <div class="upgrades" id="upgrades"></div>
  </div>
  <div class="panel">
    <div class="sub">Progresso</div>
    <div class="log" id="logArea" style="white-space:pre-wrap;"></div>
  </div>
</div>
<script>
    // Dados iniciais do jogo e loja
    const gameState = {
      coins: 0,
      cps: 0, // coins per second
      totalEarned: 0,
      workers: 0,
      miniFarms: 0,
      factories: 0,
      powerPlants: 0,
      labs: 0,
      dataCenters: 0,
      distributionNets: 0,
      megaFarms: 0,
      energyPlants: 0,
      transportCos: 0,
      headquarters: 0,
      smartCities: 0,
      farmCountries: 0,
      industrialEmpires: 0,
      progressMetropolis: 0,
      level: 1,
      timePlayed: 0,
      totalClicks: 0,
      doubleClickActive: false,
      speedBoostActive: false
    };

    // Lista hier√°rquica da loja (id, nome, custo base, requisito, emoji para visual)
    // requisito: fun√ß√£o que recebe gameState e retorna boolean (libera compra)
    const shopItems = [
      {
        id: 'worker',
        name: 'Worker',
        cost: 15,
        emoji: 'üë∑',
        req: () => true,
        qtyKey: 'workers',
        cps: 1
      },
      {
        id: 'miniFarm',
        name: 'Mini Fazenda',
        cost: 100,
        emoji: 'üåæ',
        req: (s) => s.workers >= 10,
        qtyKey: 'miniFarms',
        cps: 10
      },
      {
        id: 'factory',
        name: 'F√°brica',
        cost: 700,
        emoji: 'üè≠',
        req: (s) => s.miniFarms >= 20,
        qtyKey: 'factories',
        cps: 50
      },
      {
        id: 'powerPlant',
        name: 'Usina',
        cost: 6000,
        emoji: '‚ö°',
        req: (s) => s.factories >= 10,
        qtyKey: 'powerPlants',
        cps: 300
      },
      {
        id: 'lab',
        name: 'Laborat√≥rio',
        cost: 15000,
        emoji: 'üî¨',
        req: (s) => s.powerPlants >= 5,
        qtyKey: 'labs',
        cps: 700
      },
      {
        id: 'dataCenter',
        name: 'Central de Dados',
        cost: 50000,
        emoji: 'üñ•Ô∏è',
        req: (s) => s.labs >= 3,
        qtyKey: 'dataCenters',
        cps: 1500
      },
      {
        id: 'distributionNet',
        name: 'Rede de Distribui√ß√£o',
        cost: 150000,
        emoji: 'üì°',
        req: (s) => s.dataCenters >= 2,
        qtyKey: 'distributionNets',
        cps: 4000
      },
      {
        id: 'megaFarm',
        name: 'MegaFazenda',
        cost: 500000,
        emoji: 'üöú',
        req: (s) => s.distributionNets >= 5,
        qtyKey: 'megaFarms',
        cps: 12000
      },
      {
        id: 'energyPlant',
        name: 'Planta de Energia',
        cost: 2500000,
        emoji: 'üî•',
        req: (s) => s.megaFarms >= 3,
        qtyKey: 'energyPlants',
        cps: 30000
      },
      {
        id: 'transportCo',
        name: 'Companhia de Transporte',
        cost: 8500000,
        emoji: 'üöõ',
        req: (s) => s.energyPlants >= 4,
        qtyKey: 'transportCos',
        cps: 85000
      },
      {
        id: 'headquarters',
        name: 'Sede Corporativa',
        cost: 40000000,
        emoji: 'üè¢',
        req: (s) => s.transportCos >= 3,
        qtyKey: 'headquarters',
        cps: 200000
      },
      {
        id: 'smartCity',
        name: 'Cidade Inteligente',
        cost: 150000000,
        emoji: 'üèôÔ∏è',
        req: (s) => s.headquarters >= 2,
        qtyKey: 'smartCities',
        cps: 800000
      },
      {
        id: 'farmCountry',
        name: 'Pa√≠s das Fazendas',
        cost: 750000000,
        emoji: 'üåç',
        req: (s) => s.smartCities >= 1,
        qtyKey: 'farmCountries',
        cps: 3000000
      },
      {
        id: 'industrialEmpire',
        name: 'Imp√©rio Industrial',
        cost: 3500000000,
        emoji: 'üè∞',
        req: (s) => s.farmCountries >= 1,
        qtyKey: 'industrialEmpires',
        cps: 12000000
      },
      {
        id: 'metropolis',
        name: 'Metr√≥pole do Progresso',
        cost: 15000000000,
        emoji: 'üåÜ',
        req: (s) => s.industrialEmpires >= 1,
        qtyKey: 'progressMetropolis',
        cps: 50000000
      }
    ];

    // Upgrades simplificados, s√≥ pra exemplo (pode expandir depois)
    const upgradesList = [
      {
        id: 'upgrade1',
        name: 'Colheita mais r√°pida',
        cost: 500,
        bought: false,
        effect: () => {
          gameState.cps *= 1.2;
          log('Upgrade comprado: Colheita mais r√°pida (+20%)');
        },
        req: () => true,
      },
      {
        id: 'upgrade2',
        name: 'Trabalhadores mais eficientes',
        cost: 2000,
        bought: false,
        effect: () => {
          gameState.cps *= 1.5;
          log('Upgrade comprado: Trabalhadores mais eficientes (+50%)');
        },
        req: () => gameState.workers >= 20,
      }
    ];

    // Elementos do DOM
    const coinsDisplay = document.getElementById('coins');
    const cpsDisplay = document.getElementById('cps');
    const farmBtn = document.getElementById('farmBtn');
    const shopContainer = document.getElementById('shop');
    const upgradesContainer = document.getElementById('upgrades');
    const logArea = document.getElementById('logArea');
    const moneyTop = document.getElementById('moneyTop');
    const resetBtn = document.getElementById('resetGame');
    const backgroundItems = document.getElementById('backgroundItems');
    const configBtn = document.getElementById('configBtn');
    const modalOverlay = document.getElementById('modalOverlay');
    const themeModeSelect = document.getElementById('themeMode');
    const colorPaletteSelect = document.getElementById('colorPalette');

    // Fun√ß√£o para atualizar tela
    function updateUI() {
      coinsDisplay.textContent = formatNum(gameState.coins);
      moneyTop.textContent = formatNum(gameState.coins);
      cpsDisplay.textContent = formatNum(Number(gameState.cps).toFixed(1));

      // Atualiza n√≠vel
      document.getElementById('levelDisplay').textContent = 'N√≠vel ' + gameState.level;

      // Atualiza bot√µes loja
      shopItems.forEach(item => {
        const btn = document.querySelector(`button[data-id="${item.id}"]`);
        if (!btn) return;

        const unlocked = item.req(gameState);
        btn.disabled = !unlocked || gameState.coins < item.cost;

        // Atualiza texto bot√£o
        btn.textContent = `Comprar (${formatNum(item.cost)})`;
        if (!unlocked) {
          btn.parentElement.classList.add('locked');
          btn.parentElement.dataset.lockmsg = `Requer mais ${item.reqDesc || 'n√≠vel/quantidade'}`;
        } else {
          btn.parentElement.classList.remove('locked');
          btn.parentElement.removeAttribute('data-lockmsg');
        }
      });

      // Atualiza upgrades
      upgradesList.forEach(upg => {
        const btn = document.querySelector(`button[data-upg="${upg.id}"]`);
        if (!btn) return;
        btn.disabled = upg.bought || gameState.coins < upg.cost || !upg.req();
        btn.textContent = upg.bought ? 'Comprado' : `Comprar (${formatNum(upg.cost)})`;
        if (upg.bought) {
          btn.classList.add('bought');
        } else {
          btn.classList.remove('bought');
        }
      });

      renderBackgroundItems();
    }

    // Fun√ß√£o de formata√ß√£o para n√∫meros grandes
    function formatNum(n) {
      n = Number(n);
      if (isNaN(n)) return '0';
      if (n >= 1e12) return (n / 1e12).toFixed(2) + 'T';
      if (n >= 1e9) return (n / 1e9).toFixed(2) + 'B';
      if (n >= 1e6) return (n / 1e6).toFixed(2) + 'M';
      if (n >= 1e3) return (n / 1e3).toFixed(1) + 'K';
      return n.toString();
    }

    // Fun√ß√£o para adicionar log
    function log(msg) {
      const now = new Date().toLocaleTimeString();
      logArea.textContent = `[${now}] ${msg}\n` + logArea.textContent;
    }

    // Renderiza loja
    function renderShop() {
      shopContainer.innerHTML = '';
      shopItems.forEach(item => {
        const unlocked = item.req(gameState);
        const qty = gameState[item.qtyKey] || 0;
        const itemDiv = document.createElement('div');
        itemDiv.className = 'item' + (unlocked ? '' : ' locked');
        itemDiv.dataset.lockmsg = unlocked ? '' : `Requer mais ${getReqText(item)}`;
        itemDiv.innerHTML = `
          <div class="left">
            <span class="icon">${item.emoji}</span>
            <div>
              <div>${item.name}</div>
              <div class="meta">Voc√™ possui: ${qty}</div>
            </div>
          </div>
          <button data-id="${item.id}">Comprar (${formatNum(item.cost)})</button>
        `;
        shopContainer.appendChild(itemDiv);
      });
    }

    // Retorna texto leg√≠vel para requisito
    function getReqText(item) {
      // Exemplo simples para legibilidade
      switch (item.id) {
        case 'miniFarm': return '10 Workers';
        case 'factory': return '20 Mini Fazendas';
        case 'powerPlant': return '10 F√°bricas';
        case 'lab': return '5 Usinas';
        case 'dataCenter': return '3 Laborat√≥rios';
        case 'distributionNet': return '2 Centrais de Dados';
        case 'megaFarm': return '5 Redes de Distribui√ß√£o';
        case 'energyPlant': return '3 MegaFazendas';
        case 'transportCo': return '4 Plantas de Energia';
        case 'headquarters': return '3 Companhias de Transporte';
        case 'smartCity': return '2 Sedes Corporativas';
        case 'farmCountry': return '1 Cidade Inteligente';
        case 'industrialEmpire': return '1 Pa√≠s das Fazendas';
        case 'metropolis': return '1 Imp√©rio Industrial';
        default: return 'N√≠vel anterior';
      }
    }

    // Renderiza upgrades
    function renderUpgrades() {
      upgradesContainer.innerHTML = '';
      upgradesList.forEach(upg => {
        const btn = document.createElement('button');
        btn.className = 'upgrade';
        btn.dataset.upg = upg.id;
        btn.textContent = upg.bought ? 'Comprado' : `Comprar (${formatNum(upg.cost)})`;
        btn.disabled = upg.bought || gameState.coins < upg.cost || !upg.req();
        if (upg.bought) btn.classList.add('bought');
        upgradesContainer.appendChild(btn);

        btn.addEventListener('click', () => {
          if (gameState.coins >= upg.cost && !upg.bought && upg.req()) {
            gameState.coins -= upg.cost;
            upg.bought = true;
            upg.effect();
            updateCPS();
            log(`Upgrade comprado: ${upg.name}`);
            updateUI();
          }
        });
      });
    }

    // Calcula CPS total baseado nos itens
    function updateCPS() {
      let cps = 0;
      shopItems.forEach(item => {
        const qty = gameState[item.qtyKey] || 0;
        cps += qty * item.cps;
      });
      // Aplica buffs de upgrades se quiser
      if (upgradesList[0].bought) cps *= 1.2;
      if (upgradesList[1].bought) cps *= 1.5;
      gameState.cps = cps;
    }

    // Renderiza visualiza√ß√£o dos itens no fundo (agora dentro farm-area)
    function renderBackgroundItems() {
      backgroundItems.innerHTML = '';
      shopItems.forEach(item => {
        const qty = gameState[item.qtyKey] || 0;
        if (qty > 0) {
          const div = document.createElement('div');
          div.className = 'background-item';
          div.innerHTML = `
            <div class="left"><span class="icon" style="transform: scale(${1 + Math.log10(qty+1)})">${item.emoji}</span><span>${item.name}</span></div>
            <span class="count">${formatNum(qty)}</span>
          `;
          backgroundItems.appendChild(div);
        }
      });
    }

    // Compra item da loja
    shopContainer.addEventListener('click', e => {
      const btn = e.target.closest('button[data-id]');
      if (!btn) return;
      const id = btn.dataset.id;
      const item = shopItems.find(i => i.id === id);
      if (!item) return;

      if (!item.req(gameState)) {
        alert('Voc√™ ainda n√£o pode comprar este item!');
        return;
      }
      if (gameState.coins < item.cost) {
        alert('Voc√™ n√£o tem coins suficientes!');
        return;
      }

      gameState.coins -= item.cost;
      gameState[item.qtyKey] = (gameState[item.qtyKey] || 0) + 1;
      updateCPS();
      updateUI();
      log(`Comprou 1 ${item.name} por ${formatNum(item.cost)} coins`);
    });

    // Bot√£o colher
    farmBtn.addEventListener('click', () => {
      let gain = 1;
      if (gameState.doubleClickActive) gain *= 2;
      gameState.coins += gain;
      gameState.totalClicks++;
      updateUI();
      log(`Colheu +${gain} coins.`);
    });

    // Eventos upgrades bot√µes extras (por enquanto n√£o implementados)
    document.getElementById('doubleClick').addEventListener('click', () => {
      if (gameState.coins < 10) {
        alert('Faltam coins para ativar o Double Click!');
        return;
      }
      if (gameState.doubleClickActive) {
        alert('Double Click j√° est√° ativo!');
        return;
      }
      gameState.coins -= 10;
      gameState.doubleClickActive = true;
      log('Double Click ativado por 30 segundos!');
      updateUI();
      setTimeout(() => {
        gameState.doubleClickActive = false;
        log('Double Click terminou!');
        updateUI();
      }, 30000);
    });
    document.getElementById('speedBoost').addEventListener('click', () => {
      if (gameState.coins < 20) {
        alert('Faltam coins para ativar Speed Boost!');
        return;
      }
      if (gameState.speedBoostActive) {
        alert('Speed Boost j√° est√° ativo!');
        return;
      }
      gameState.coins -= 20;
      gameState.speedBoostActive = true;
      log('Speed Boost de Auto-Click 2x ativado por 30 segundos!');
      updateUI();
      const intervalId = setInterval(() => {
        gameState.coins += gameState.cps;
        updateUI();
      }, 500);
      setTimeout(() => {
        gameState.speedBoostActive = false;
        clearInterval(intervalId);
        log('Speed Boost terminou!');
        updateUI();
      }, 30000);
    });

    // Game loop que adiciona coins automaticamente
    setInterval(() => {
      gameState.coins += gameState.cps;
      gameState.totalEarned += gameState.cps;
      gameState.timePlayed++;
      updateUI();
    }, 1000);

    // Bot√£o reiniciar jogo
    resetBtn.addEventListener('click', () => {
      if (confirm('Tem certeza que deseja reiniciar o jogo? Todo progresso ser√° perdido.')) {
        localStorage.removeItem('miniTycoonSave');
        location.reload();
      }
    });

    // Salvar jogo a cada 5 segundos
    setInterval(() => {
      saveGame();
    }, 5000);

    // Salvar no localStorage
    function saveGame() {
      const saveData = {
        ...gameState,
        upgrades: upgradesList.map(u => u.bought)
      };
      localStorage.setItem('miniTycoonSave', JSON.stringify(saveData));
      document.getElementById('autoSaveStatus').textContent = 'ON';
    }

    // Carregar do localStorage
    function loadGame() {
      const saved = localStorage.getItem('miniTycoonSave');
      if (!saved) return false;
      try {
        const data = JSON.parse(saved);
        Object.assign(gameState, data);
        upgradesList.forEach((u, i) => u.bought = data.upgrades ? data.upgrades[i] : false);
        updateCPS();
        log('Jogo carregado do armazenamento local.');
        return true;
      } catch {
        return false;
      }
    }

    // Configura√ß√µes - abrir e fechar modal
    configBtn.addEventListener('click', () => {
      modalOverlay.classList.add('active');
      // Atualiza selects para estado atual
      themeModeSelect.value = document.body.classList.contains('clear') ? 'clear' : 'dark';
      const bodyClasses = [...document.body.classList];
      const paletteClass = bodyClasses.find(c => c.startsWith('palette-')) || 'palette-default';
      colorPaletteSelect.value = paletteClass.replace('palette-', '');
    });

    document.getElementById('closeConfig').addEventListener('click', () => {
      modalOverlay.classList.remove('active');
    });

    // Aplicar configura√ß√µes
    themeModeSelect.addEventListener('change', () => {
      if (themeModeSelect.value === 'clear') {
        document.body.classList.add('clear');
      } else {
        document.body.classList.remove('clear');
      }
    });
    colorPaletteSelect.addEventListener('change', () => {
      document.body.classList.remove('palette-red', 'palette-yellow', 'palette-purple', 'palette-black', 'palette-default');
      if (colorPaletteSelect.value !== 'default') {
        document.body.classList.add('palette-' + colorPaletteSelect.value);
      } else {
        document.body.classList.add('palette-default');
      }
    });

    // Inicializa√ß√£o
    function init() {
      renderShop();
      renderUpgrades();
      if (!loadGame()) {
        updateCPS();
      }
      updateUI();
      log('Bem vindo ao Mini Tycoon! Comece colhendo moedas e comprando itens.');
    }
    init();
  </script>
</body>
</html>
